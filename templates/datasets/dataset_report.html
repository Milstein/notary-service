{% extends 'base.html' %}
{% load static dataset_tags replace_tags user_tags %}

{% block title %}Infrastructure for Privacy-Assured CompuTations{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        {% if not user.is_norole %}
            <div class="container">
            <h3>Dataset / Workflow Report: {{ dataset.name }}</h3>

            Project:
            <a href="{% url 'project_detail' uuid=project.uuid %}">
                {{ project.name }}
            </a>
            > Dataset:
            <a href="{% url 'dataset_detail' uuid=dataset.uuid %}">
                {{ dataset.name }}
            </a>
            <br><br>

            {% for report in workflow_reports %}
                <b>Workflow: </b>{{ report.workflow.name }} - {{ report.workflow.affiliation }}<br>
                <div style="background-color: #DCDCDC;color:darkblue;font-family:Courier;
                font-size: 14px; overflow-x: scroll; height: 300px; overflow-y: scroll; white-space: nowrap">
                    {% for node in report.nodes %}
                        [{{ node.ts|date:"Y-m-d H:i:s.u e" }}] - person="{{ node.person }}"
                        role="{{ node.role }}"
                        node(type)="{{ node.label }}({{ node.tp }})"
                        value="{{ node.pv }}"
                        <br>
                    {% endfor %}
                </div>
                <br>
            {% endfor %}
            <br>
            <br>
            <table width="100%" style="font-size: small">
                <tr>
                    <td width="60%">
                        <b>Created By:</b> {{ dataset.created_by }}
                    </td>
                    <td>
                        <b>Modified By:</b> {{ dataset.modified_by }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Created Date:</b> {{ dataset.created_date|date:"m/d/Y g:i a" }}
                    </td>
                    <td>
                        <b>Modified Date:</b> {{ dataset.modified_date|date:"m/d/Y g:i a" }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Validated:</b> {{ dataset.is_valid }}
                        {% if dataset.is_valid %}
                            (<i class="fa fa-fw fa-check" style="color: green;"></i>)
                        {% else %}
                            (<i class="fa fa-fw fa-remove" style="color: #B22222;"></i>)
                        {% endif %}
                    </td>
                </tr>
            </table>
        {% endif %}
    </div>
    {% else %}
        <div class="container">
            <p>You are not currently logged in or not authorized to view this page</p>
        </div>
    {% endif %}
{% endblock %}